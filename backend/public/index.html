<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Demo - proyecto-alpha</title>
    <style>
      body { font-family: Arial, Helvetica, sans-serif; max-width: 900px; margin: 40px auto; padding: 0 16px; }
      h1 { color: #333 }
      .card { border: 1px solid #ddd; padding: 16px; border-radius: 6px; margin-bottom: 16px }
      label { display:block; margin-top:8px }
      input { padding:8px; width:100%; box-sizing:border-box }
      button { margin-top:10px; padding:8px 12px }
      pre { background:#f5f5f5; padding:12px; border-radius:4px }
    </style>
  </head>
  <body>
    <h1>Demo - proyecto-alpha</h1>

    <div class="card">
      <h2>Registrar usuario</h2>
      <label>Nombre <input id="reg-name" placeholder="Nombre" /></label>
      <label>Email <input id="reg-email" placeholder="email@ejemplo.com" /></label>
      <label>Contraseña <input id="reg-password" type="password" placeholder="password" /></label>
      <button id="btn-register">Registrar</button>
      <div id="reg-result"></div>
    </div>

    <div class="card">
      <h2>Iniciar sesión</h2>
      <label>Email <input id="login-email" placeholder="email@ejemplo.com" /></label>
      <label>Contraseña <input id="login-password" type="password" placeholder="password" /></label>
      <button id="btn-login">Iniciar sesión</button>
      <div id="login-result"></div>
    </div>

    <div class="card">
      <h2>Datos protegidos</h2>
      <p>Token actual: <code id="token-display">(ninguno)</code></p>
      <button id="btn-get-data">Pedir /api/data</button>
      <button id="btn-logout">Cerrar sesión</button>
      <div id="data-result"></div>
    </div>

    <script>
      const setResult = (el, payload) => {
        document.getElementById(el).innerHTML = '<pre>' + JSON.stringify(payload, null, 2) + '</pre>';
      };

      const tokenDisplay = document.getElementById('token-display');
      const getToken = () => localStorage.getItem('token');
      const setToken = (t) => { if (t) { localStorage.setItem('token', t); tokenDisplay.textContent = t; } else { localStorage.removeItem('token'); tokenDisplay.textContent = '(ninguno)'; } };

      // Initialize token display
      if (getToken()) tokenDisplay.textContent = getToken();

      document.getElementById('btn-register').addEventListener('click', async () => {
        const name = document.getElementById('reg-name').value;
        const email = document.getElementById('reg-email').value;
        const password = document.getElementById('reg-password').value;
        try {
          const res = await fetch('/api/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email, password })
          });
          const body = await res.json();
          setResult('reg-result', { status: res.status, body });
          if (body.token) setToken(body.token);
        } catch (err) {
          setResult('reg-result', { error: err.message });
        }
      });

      document.getElementById('btn-login').addEventListener('click', async () => {
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        try {
          const res = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          });
          const body = await res.json();
          setResult('login-result', { status: res.status, body });
          if (body.token) setToken(body.token);
        } catch (err) {
          setResult('login-result', { error: err.message });
        }
      });

      document.getElementById('btn-get-data').addEventListener('click', async () => {
        try {
          const token = getToken();
          const res = await fetch('/api/data', {
            method: 'GET',
            headers: token ? { 'Authorization': 'Bearer ' + token } : {}
          });
          const body = await res.json();
          setResult('data-result', { status: res.status, body });
        } catch (err) {
          setResult('data-result', { error: err.message });
        }
      });

      document.getElementById('btn-logout').addEventListener('click', () => {
        setToken(null);
        setResult('data-result', { info: 'Sesión cerrada' });
      });
    </script>
  </body>
</html>
